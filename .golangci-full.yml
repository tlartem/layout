version: "2"

# Настройки линтеров
linters:
  # Набор линтеров по умолчанию.
  # Возможные значения:
  # - `standard`: https://golangci-lint.run/usage/linters/#enabled-by-default
  # - `all`: включает все линтеры по умолчанию.
  # - `none`: отключает все линтеры по умолчанию.
  # - `fast`: включает только те линтеры, которые считаются "быстрыми"
  #   (`golangci-lint help linters --json | jq '[ .[] | select(.fast==true) ] | map(.name)'`)
  # По умолчанию: standard
  default: none
  enable:
    - asasalint           # Проверяет передачу срезов в вариативные функции, чтобы избежать неявных ошибок.
    - asciicheck          # Убеждается, что все идентификаторы содержат только ASCII-символы.
    - bidichk             # Обнаруживает опасные последовательности символов Unicode, такие как управляющие символы направления текста.
    - bodyclose           # Проверяет, что `res.Body` закрывается после использования, предотвращая утечки ресурсов.
    - canonicalheader     # Проверяет, что заголовки HTTP имеют канонический формат.
    - containedctx        # Обнаруживает структуры, содержащие `context.Context` как поле, что не рекомендуется.
    - contextcheck        # Проверяет, что функции используют унаследованный контекст, предотвращая потерю контекста.
    - copyloopvar         # Обнаруживает случаи, когда переменные цикла копируются, что может привести к ошибкам.
    - cyclop              # Вычисляет цикломатическую сложность функций и пакетов, помогая выявить сложные участки кода.
    - decorder            # Проверяет порядок объявления типов, констант, переменных и функций.
    - depguard            # Запрещает или разрешает импорт определённых пакетов, обеспечивая контроль зависимостей.
    - dogsled             # Обнаруживает присваивания с множественными пустыми идентификаторами (например, `x, _, _, _ := f()`).
    - dupl                # Обнаруживает дублирование кода, помогая снизить технический долг.
    - dupword             # Проверяет наличие повторяющихся слов в коде, часто возникающих из-за опечаток.
    - durationcheck       # Обнаруживает ошибочные операции с `time.Duration`, такие как умножение двух значений `Duration`.
    - err113              # Рекомендует использовать типизированные ошибки вместо `errors.New(...)` для улучшения обработки ошибок.
    - errcheck            # Проверяет, что ошибки из функций обрабатываются, а не игнорируются.
    - errchkjson          # Проверяет правильность обработки ошибок при работе с JSON.
    - errname             # Убедитесь, что имена переменных ошибок соответствуют соглашениям (например, `errFoo`).
    - errorlint           # Проверяет корректность обёртывания и сравнения ошибок.
    - exhaustive          # Обеспечивает исчерпывающий разбор `switch` по перечислениям.
#    - exhaustruct         # Проверяет, что все поля структуры инициализированы при её создании.
    - exptostd            # Предлагает замену экспериментальных API на стандартные аналоги.
    - fatcontext          # Обнаруживает использование `context.Background()` или `context.TODO()` в функциях, где следует передавать контекст.
#    - forbidigo           # Запрещает использование определённых выражений или функций, указанных в конфигурации.
    - forcetypeassert     # Обнаруживает небезопасные приведения типов, которые могут привести к панике.
#    - funcorder           # Проверяет порядок объявления функций для улучшения читаемости.
    - funlen              # Проверяет длину функций, помогая поддерживать их краткими и понятными.
    - ginkgolinter        # Проверяет тесты, написанные с использованием Ginkgo, на соответствие лучшим практикам.
    - gocheckcompilerdirectives  # Проверяет правильность использования директив компилятора.
    - gochecknoglobals    # Обнаруживает глобальные переменные, которые могут усложнить тестирование и сопровождение.
    - gochecknoinits      # Предупреждает о наличии функций `init`, которые могут скрывать инициализацию.
    - gochecksumtype      # Проверяет, что типы сумм соответствуют ожидаемым (например, `uint32` для контрольных сумм).
    - gocognit            # Анализирует когнитивную сложность функций, помогая выявить сложные для понимания участки.
    - goconst             # Обнаруживает повторяющиеся строковые или числовые литералы, предлагая вынести их в константы.
    - gocritic            # Собрание различных проверок кода, включая стиль, ошибки и потенциальные проблемы.
    - gocyclo             # Проверяет цикломатическую сложность функций, аналогично `cyclop`.
    - godot               # Проверяет, что комментарии к экспортируемым элементам заканчиваются точкой.
    - godox               # Обнаруживает комментарии с `TODO`, `FIXME` и подобными тегами.
    - goheader            # Проверяет наличие и корректность заголовков файлов (например, лицензий).
    - gomoddirectives     # Проверяет директивы в `go.mod` на корректность и соответствие рекомендациям.
    - gomodguard          # Запрещает или разрешает определённые зависимости в `go.mod`.
    - goprintffuncname    # Проверяет, что функции, использующие форматирование (например, `Printf`), имеют соответствующие имена.
    - gosec               # Анализирует код на наличие известных уязвимостей безопасности.
    - gosmopolitan        # Проверяет совместимость кода с библиотекой Cosmopolitan.
    - govet               # Встроенный инструмент Go для обнаружения потенциальных ошибок в коде.
    - grouper             # Проверяет группировку импортов и других элементов для улучшения читаемости.
    - iface               # Обнаруживает интерфейсы, которые реализуются только одним типом, предлагая заменить их на конкретные типы.
    - importas            # Проверяет, что импорты имеют ожидаемые псевдонимы.
    - inamedparam         # Проверяет, что именованные параметры функций используются корректно.
    - ineffassign         # Обнаруживает неэффективные присваивания, которые не используются.
    - interfacebloat      # Предупреждает о слишком больших интерфейсах, которые могут быть сложны в реализации.
    - intrange            # Проверяет диапазоны целых чисел на корректность и потенциальные ошибки.
#    - ireturn             # Анализирует возвращаемые значения функций на соответствие ожиданиям.
    - lll                 # Проверяет длину строк, помогая соблюдать ограничения по длине.
    - loggercheck         # Проверяет корректность использования логгеров в коде.
    - maintidx            # Анализирует индексируемость кода для улучшения поддержки и сопровождения.
    - makezero            # Предлагает использовать `make` для инициализации срезов и карт с нулевой длиной.
    - mirror              # Проверяет зеркальность определённых структур или данных.
    - misspell            # Обнаруживает опечатки в комментариях и строках.
#    - mnd                 # Обнаруживает "магические числа" в коде, предлагая заменить их на именованные константы.
    - musttag             # Проверяет наличие обязательных тегов в структурах (например, `json`).
    - nakedret            # Предупреждает о "голых" возвратах, которые могут снизить читаемость.
    - nestif              # Обнаруживает чрезмерную вложенность `if`-выражений, предлагая упростить логику.
    - nilerr              # Проверяет корректность обработки `nil` ошибок.
    - nilnesserr          # Анализирует возможные ошибки, связанные с `nil` значениями.
    - nilnil              # Обнаруживает случаи, когда переменные инициализируются `nil` без необходимости.
    - nlreturn            # Проверяет наличие пустых строк перед операторами `return` для улучшения читаемости.
    - noctx               # Предупреждает о функциях, которые не принимают `context.Context` в качестве параметра.
    - nolintlint          # Проверяет корректность использования директив `//nolint`.
#    - nonamedreturns      # Предупреждает о функциях с именованными возвращаемыми значениями, которые не используются.
    - nosprintfhostport   # Предупреждает о небезопасном форматировании строк для хостов и портов.
    - paralleltest        # Обнаруживает тесты, которые могут быть выполнены параллельно, но не используют `t.Parallel()`.
    - perfsprint          # Предлагает более эффективные способы форматирования строк, избегая ненужных аллокаций.
    - prealloc            # Предлагает предварительное выделение памяти для срезов, когда это возможно.
    - predeclared         # Предупреждает о переопределении предопределённых идентификаторов.
    - promlinter          # Проверяет корректность метрик Prometheus в коде.
    - protogetter         # Проверяет геттеры, сгенерированные из `.proto` файлов, на соответствие ожиданиям.
    - reassign            # Предупреждает о повторных присваиваниях переменным, которые могут быть ошибочными.
    - recvcheck           # Проверяет корректность использования приёмников в методах.
#    - revive              # Расширяемый и настраиваемый линтер для Go, предлагающий множество проверок.
    - rowserrcheck        # Проверяет, что ошибки при работе с базами данных обрабатываются корректно.
    - sloglint            # Проверяет использование структурированного логгирования с `slog`.
    - spancheck           # Анализирует использование трассировок и спанов в коде.
    - sqlclosecheck       # Убеждается, что объекты базы данных закрываются после использования.
    - staticcheck         # Набор статических анализаторов для Go, обнаруживающих ошибки и потенциальные проблемы.
    - tagalign            # Проверяет выравнивание тегов структур для улучшения читаемости.
#    - tagliatelle         # Проверяет стиль и форматирование тегов структур.
    - testableexamples    # Убеждается, что примеры в документации могут быть скомпилированы и протестированы.
    - testifylint         # Проверяет корректность использования библиотеки `testify` в тестах.
    - testpackage         # Предупреждает о тестах, находящихся в том же пакете, что и тестируемый код.
    - thelper             # Проверяет, что вспомогательные функции в тестах вызывают `t.Helper()` для корректного отображения источника ошибок.
    - tparallel           # Убедитесь, что под-тесты в `testing.T.Run()` используют `t.Parallel()` для параллельного выполнения.
    - unconvert           # Обнаруживает избыточные приведения типов, которые не влияют на тип результата.
    - unparam             # Удаляет неиспользуемые параметры в функциях и методах.
    - unused              # Находит неиспользуемые переменные, функции и типы (анализ на основе SSA).
    - usestdlibvars       # Предупреждает о переопределении стандартных переменных (например, `http.DefaultClient`) и рекомендует их использовать.
    - usetesting          # Обнаруживает код, который можно заменить на стандартные функции пакета `testing`.
#    - varnamelen          # Проверяет длину имён переменных, чтобы избежать слишком коротких или слишком длинных имён.
    - wastedassign        # Предупреждает о присваиваниях, результат которых не используется.
    - whitespace          # Обнаруживает избыточные или отсутствующие пробелы для улучшения форматирования кода.
    - wrapcheck           # Проверяет, что ошибки оборачиваются при передаче, чтобы сохранить стек вызовов.
    - wsl                 # Проверяет наличие пробела в конце строки и другие мелкие проблемы с пробелами.
    - zerologlint         # Проверяет корректность использования библиотеки логгирования `zerolog`.


  # Тонкая настройка нужного линтера (если есть)
  # См. отдельную секцию документации https://golangci-lint.run/usage/linters/#linters-configuration
  settings:
    gocritic:
      enabled-tags:
        - diagnostic
        - style
        - experimental
        - opinionated
      disabled-checks:
        - whyNoLint

    depguard:
      # Правила, которые будут применяться.
      #
      # Переменные:
      # - Переменные для файлов:
      #   Используйте восклицательный знак `!`, чтобы обратить условие (отрицание).
      #   Пример: `!$test` — соответствует всем файлам, КРОМЕ тестов.
      #
      #   `$all` — соответствует всем Go-файлам
      #   `$test` — соответствует всем Go-файлам с тестами
      #
      # - Переменные для пакетов:
      #
      #   `$gostd` — соответствует всем стандартным пакетам Go (получено из `GOROOT`)
      #
      # По умолчанию (если не указаны пользовательские правила): разрешены только `$gostd` во всех файлах.
      rules:
        # Название правила.
        main:
          # Определяет поведение сопоставления с пакетами. Доступные режимы:
          # - `original`: разрешено, если не попадает в список запрещённых (deny) и попадает в список разрешённых (allow), либо список allow пуст.
          # - `strict`: разрешено ТОЛЬКО если попадает в allow и ЛИБО не попадает в deny, ЛИБО правило из allow более специфично (длиннее), чем из deny.
          # - `lax`: разрешено, если не попадает в deny, ИЛИ правило из allow более специфично (длиннее), чем deny.
          # По умолчанию: "original"
          list-mode: lax

          # Список разрешённых пакетов.
          # Элемент может быть переменной ($), префиксом строки или точным совпадением (если заканчивается на $).
          # По умолчанию: []
          allow:
            - $gostd

          # Список запрещённых пакетов.
          # Элемент может быть переменной ($), префиксом строки или точным совпадением (если заканчивается на $).
          # По умолчанию: []
          deny:
            - pkg: "math/rand$"
              desc: Используйте math/rand/v2
            - pkg: "github.com/sirupsen/logrus"
              desc: Используйте Zerolog или Zap вместо Logrus
            - pkg: "github.com/pkg/errors"
              desc: Следует заменить на стандартный пакет `errors`
#            - pkg: "go.uber.org/automaxprocs"
#              desc: Беда, не используйте этот пакет!!!


  # Определяет набор правил для игнорирования предупреждений.
  # Анализ при этом выполняется, поэтому ошибки "typecheck" всё равно будут выдаваться.
  exclusions:
    # Режим анализа сгенерированных файлов.
    # - `strict`: исключает файлы строго по официальному шаблону комментария:
    #     `^// Code generated .* DO NOT EDIT\.$`
    #     Эта строка должна находиться до любого другого кода или комментариев.
    #     Подробнее: https://go.dev/s/generatedcode
    # - `lax`: исключает файлы, содержащие строки вроде `autogenerated file`, `code generated`, `do not edit` и т.п.
    # - `disable`: полностью отключает исключения для сгенерированных файлов.
    # По умолчанию: strict
    generated: lax

    # Выводить предупреждение, если правило исключения не используется.
    # По умолчанию: false
    warn-unused: false

    # Предустановленные правила исключения.
    #   - comments                 # отключает типичные замечания к комментариям
    #   - std-error-handling       # отключает незначительные ошибки при обработке ошибок
    #   - common-false-positives   # отключает частые ложные срабатывания
    #   - legacy                   # отключает строгие правила для унаследованного кода
    # По умолчанию: []
    presets:
      - comments                  # отключает типичные замечания к комментариям
      - std-error-handling        # отключает незначительные ошибки при обработке ошибок

    # Пути к файлам, которые будут анализироваться, но их ошибки не будут выводиться.
    # Символ `/` будет автоматически заменён на правильный разделитель пути (например, `\` на Windows).
    # По умолчанию: []
    paths:
      - _test.go
      - gen/
      - test/integration/

    # Пути к файлам, которые **не должны быть исключены**.
    # По умолчанию: []
    paths-except:
      - ".*\\.except\\.go$"
      - lib/except.go

    # Исключающие правила по пути, линтеру, тексту и исходнику.
    rules:
      # Исключаем определённые линтеры для файлов по пути
      - path: pkg/logger
        linters:
          - zerologlint

      - path: internal/app
        linters:
          - contextcheck

      - path: internal/controller/grpc/
        linters:
          - wrapcheck

      - path: internal/controller/http/v2
        linters:
          - wrapcheck

      # Исключаем некоторые сообщения по тексту ошибки
      - linters:
          - err113
        text: "do not define dynamic errors"

      # Исключаем некоторые сообщения по коду в файле
      - linters:
          - lll
        source: "^//go:generate "

# Опции форматирования кода.
formatters:
  # Включение конкретных форматтеров.
  # По умолчанию: [] (используется стандартное форматирование Go)
  enable:
    - gci          # Упорядочивает импорты по группам (стандартные, сторонние, локальные)
    - gofmt        # Стандартный инструмент форматирования кода Go
    - gofumpt      # Более строгая версия gofmt с улучшенной читаемостью
    - goimports    # Форматирует код и автоматически управляет импортами

  # Настройки для форматтеров.
    # См. раздел документации https://golangci-lint.run/usage/formatters/
  settings:
    gofumpt:
      extra-rules: true
    gci:
      sections:
        - standard # Standard section: captures all standard packages.
        - default # Default section: contains all imports that could not be matched to another section type.
        - blank # Blank section: contains all blank imports. This section is not present unless explicitly enabled.
        - dot # Dot section: contains all dot imports. This section is not present unless explicitly enabled.
        - localmodule # Local module section: contains all local packages. This section is not present unless explicitly enabled.
        - alias # Alias section: contains all alias imports. This section is not present unless explicitly enabled.

  exclusions:
    # Предупреждать, если путь для исключения не используется.
    # По умолчанию: false
    warn-unused: false

    # Режим анализа сгенерированных файлов.
    #
    # - `strict`: исключает только те файлы, которые содержат строку:
    #     `^// Code generated .* DO NOT EDIT\.$`
    #     Эта строка должна быть первой в файле (до любого другого содержимого).
    #     Подробнее: https://go.dev/s/generatedcode
    # - `lax`: исключает файлы, содержащие такие строки, как `autogenerated file`, `code generated`, `do not edit`
    # - `disable`: не исключать сгенерированные файлы вообще
    #
    # По умолчанию: lax
    generated: disable

    # Пути к файлам, которые исключаются из форматирования.
    # По умолчанию: []
    paths:
      - ".*\\.my\\.go$"
      - gen

# Опции конфигурации линтера.
issues:
  # Максимальное количество ошибок, отображаемых для одного линтера.
  # Установите 0, чтобы отключить ограничение.
  # По умолчанию: 50
  max-issues-per-linter: 0

  # Максимальное количество одинаковых сообщений об ошибке.
  # Установите 0, чтобы отключить ограничение.
  # По умолчанию: 3
  max-same-issues: 0

  # Делает вывод уникальным по строкам кода.
  # По умолчанию: true
  uniq-by-line: true

  # Показывать только новые ошибки:
  # если есть нестейдженные изменения или неотслеживаемые файлы — анализируются только они,
  # иначе сравнение идёт с предыдущим коммитом (HEAD~).
  # Очень удобно при интеграции линтера в большой существующий проект:
  # не нужно исправлять весь код сразу — достаточно следить за качеством нового.
  #
  # По умолчанию: false
  new: false

  # Показывать только ошибки, возникшие после общего предка ветки (merge-base против HEAD).
  # По умолчанию: ""
  new-from-merge-base: ""

  # Показывать ошибки только после определённой git-ревизии.
  # По умолчанию: ""
  new-from-rev: ""

  # Показывать ошибки только в патче, заданном по файлу.
  # По умолчанию: ""
  new-from-patch: ""

  # Показывать все ошибки в файле, если он попал под анализ
  # (требует `new-from-rev` или `new-from-patch`).
  # По умолчанию: false
  whole-files: false

  # Автоматически исправлять найденные ошибки (если поддерживается линтером).
  # По умолчанию: false
  fix: true


# Опции конфигурации вывода результатов.
output:
  # Форматы, в которых выводятся найденные проблемы.
  formats:
    # Вывод в текстовом формате с цветами, номерами строк и названиями линтеров.
    # Это формат используется по умолчанию.
    text:
      # Куда выводить результаты: `stdout`, `stderr` или путь к файлу.
      # По умолчанию: stdout
      path: stdout
      # Показывать имя линтера в конце текста ошибки.
      # По умолчанию: true
      print-linter-name: true
      # Показывать строку кода, в которой найдена ошибка.
      # По умолчанию: true
      print-issued-lines: true
      # Использовать цветной вывод.
      # По умолчанию: true
      colors: true

  # Добавляет префикс ко всем ссылкам на файлы в выводе.
  # Игнорируется, если используется режим `output.path-mode: abs`.
  # По умолчанию: ""
  path-prefix: ""

  # По умолчанию путь в отчётах определяется по `run.relative-path-mode`.
  # Режим `abs` показывает абсолютные пути к файлам вместо относительных.
  # Параметр `output.path-prefix` игнорируется при `abs`.
  # По умолчанию: ""
  path-mode: ""

  # Определяет порядок сортировки результатов.
  # Возможные значения: `file`, `linter`, `severity`.
  #
  # Если используется сортировка по `severity`, то порядок такой:
  #   1. error
  #   2. warning
  #   3. high
  #   4. medium
  #   5. low
  # В противном случае сортировка идёт по алфавиту.
  #
  # По умолчанию: ["linter", "file"]
  sort-order:
    - linter
    - file # путь к файлу, строка, колонка

  # Показывать статистику по каждому линтеру.
  # По умолчанию: true
  show-stats: true


# Опции для запуска анализа.
run:
  # Таймаут для всего процесса анализа (например: 30s, 5m, 5m30s).
  # Если значение ≤ 0, таймаут отключается.
  # По умолчанию: 0 (отключено)
  timeout: 5m

  # Режим, используемый для вычисления относительных путей.
  # Используется в исключениях, Go-плагинах и некоторых линтерах.
  # Возможные значения:
  # - `gomod`: пути считаются относительно директории с `go.mod`.
  # - `gitroot`: пути считаются относительно корня git-репозитория (где находится `.git`).
  # - `cfg`: пути считаются относительно текущего конфигурационного файла.
  # - `wd` (НЕ рекомендуется): пути считаются относительно директории, откуда запускается golangci-lint.
  # По умолчанию: cfg
  relative-path-mode: gomod

  # Код возврата, если найдена хотя бы одна проблема.
  # По умолчанию: 1
  issues-exit-code: 1

  # Включать ли файлы тестов в анализ.
  # По умолчанию: true
  tests: true

  # Разрешить одновременный запуск нескольких экземпляров golangci-lint.
  # Если false — создаётся блокировка при запуске.
  # По умолчанию: false
  allow-parallel-runners: true

  # Разрешить запуск нескольких экземпляров, но синхронизировать их по блокировке.
  # По умолчанию: false
  allow-serial-runners: true

  # Ограничение версии Go для анализа.
  # По умолчанию: берётся из go.mod, затем из переменной окружения `GOVERSION`, иначе — 1.22.
  go: '1.23'

  # Количество потоков ОС (`GOMAXPROCS`), которое может использовать golangci-lint одновременно.
  # По умолчанию: 0 (определяется автоматически в зависимости от лимита CPU в контейнере Linux или количества логических ядер)
  concurrency: 16